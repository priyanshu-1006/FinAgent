<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FinAgent - AI Financial Automation Dashboard</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary: #6366f1;
        --primary-dark: #4f46e5;
        --primary-light: #818cf8;
        --success: #10b981;
        --success-light: #34d399;
        --warning: #f59e0b;
        --warning-light: #fbbf24;
        --danger: #ef4444;
        --danger-light: #f87171;

        --bg-dark: #0f0f1a;
        --bg-card: #1a1a2e;
        --bg-card-hover: #252540;
        --bg-elevated: #16162a;

        --text-primary: #ffffff;
        --text-secondary: #a1a1aa;
        --text-muted: #71717a;

        --border: rgba(255, 255, 255, 0.08);
        --border-light: rgba(255, 255, 255, 0.12);

        --gradient-primary: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
        --gradient-success: linear-gradient(135deg, #10b981 0%, #34d399 100%);
        --gradient-warning: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%);
        --gradient-danger: linear-gradient(135deg, #ef4444 0%, #f87171 100%);
        --gradient-dark: linear-gradient(180deg, #1a1a2e 0%, #0f0f1a 100%);

        --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.3);
        --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.4);
        --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.5);
        --shadow-glow: 0 0 40px rgba(99, 102, 241, 0.15);

        --radius-sm: 8px;
        --radius-md: 12px;
        --radius-lg: 16px;
        --radius-xl: 24px;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, sans-serif;
        background: var(--bg-dark);
        color: var(--text-primary);
        min-height: 100vh;
        overflow-x: hidden;
      }

      /* Animated Background */
      .bg-animation {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 0;
        overflow: hidden;
      }

      .bg-animation::before {
        content: "";
        position: absolute;
        width: 600px;
        height: 600px;
        background: radial-gradient(
          circle,
          rgba(99, 102, 241, 0.15) 0%,
          transparent 70%
        );
        top: -200px;
        right: -200px;
        animation: float 20s ease-in-out infinite;
      }

      .bg-animation::after {
        content: "";
        position: absolute;
        width: 500px;
        height: 500px;
        background: radial-gradient(
          circle,
          rgba(139, 92, 246, 0.1) 0%,
          transparent 70%
        );
        bottom: -150px;
        left: -150px;
        animation: float 25s ease-in-out infinite reverse;
      }

      @keyframes float {
        0%,
        100% {
          transform: translate(0, 0) rotate(0deg);
        }
        25% {
          transform: translate(50px, 50px) rotate(5deg);
        }
        50% {
          transform: translate(0, 100px) rotate(0deg);
        }
        75% {
          transform: translate(-50px, 50px) rotate(-5deg);
        }
      }

      /* Layout */
      .app {
        position: relative;
        z-index: 1;
        display: grid;
        grid-template-rows: auto 1fr;
        min-height: 100vh;
      }

      /* Header */
      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 16px 32px;
        background: rgba(26, 26, 46, 0.8);
        backdrop-filter: blur(20px);
        border-bottom: 1px solid var(--border);
        position: sticky;
        top: 0;
        z-index: 100;
      }

      .logo {
        display: flex;
        align-items: center;
        gap: 16px;
      }

      .logo-icon {
        width: 48px;
        height: 48px;
        background: var(--gradient-primary);
        border-radius: var(--radius-md);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        box-shadow: var(--shadow-glow);
      }

      .logo-text {
        display: flex;
        flex-direction: column;
      }

      .logo-title {
        font-size: 24px;
        font-weight: 800;
        background: linear-gradient(135deg, #fff 0%, #a1a1aa 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        letter-spacing: -0.5px;
      }

      .logo-subtitle {
        font-size: 12px;
        color: var(--text-muted);
        font-weight: 500;
        letter-spacing: 1px;
        text-transform: uppercase;
      }

      .header-actions {
        display: flex;
        align-items: center;
        gap: 16px;
      }

      .status-indicator {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px 20px;
        background: var(--bg-card);
        border-radius: 50px;
        border: 1px solid var(--border);
      }

      .status-dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: var(--danger);
        box-shadow: 0 0 10px var(--danger);
        transition: all 0.3s;
      }

      .status-indicator.connected .status-dot {
        background: var(--success);
        box-shadow: 0 0 10px var(--success);
        animation: pulse-dot 2s infinite;
      }

      @keyframes pulse-dot {
        0%,
        100% {
          transform: scale(1);
          opacity: 1;
        }
        50% {
          transform: scale(1.2);
          opacity: 0.7;
        }
      }

      .status-text {
        font-size: 14px;
        font-weight: 500;
        color: var(--text-secondary);
      }

      .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 12px 24px;
        font-size: 14px;
        font-weight: 600;
        border: none;
        border-radius: var(--radius-md);
        cursor: pointer;
        transition: all 0.2s ease;
        font-family: inherit;
      }

      .btn-primary {
        background: var(--gradient-primary);
        color: white;
        box-shadow: 0 4px 16px rgba(99, 102, 241, 0.4);
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 24px rgba(99, 102, 241, 0.5);
      }

      .btn-success {
        background: var(--gradient-success);
        color: white;
        box-shadow: 0 4px 16px rgba(16, 185, 129, 0.4);
      }

      .btn-success:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 24px rgba(16, 185, 129, 0.5);
      }

      .btn-danger {
        background: var(--gradient-danger);
        color: white;
        box-shadow: 0 4px 16px rgba(239, 68, 68, 0.4);
      }

      .btn-danger:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 24px rgba(239, 68, 68, 0.5);
      }

      .btn-ghost {
        background: transparent;
        color: var(--text-secondary);
        border: 1px solid var(--border);
      }

      .btn-ghost:hover {
        background: var(--bg-card);
        border-color: var(--border-light);
      }

      /* Main Content */
      .main {
        display: grid;
        grid-template-columns: 400px 1fr 380px;
        gap: 24px;
        padding: 24px 32px;
        max-width: 1920px;
        margin: 0 auto;
        width: 100%;
      }

      /* Cards */
      .card {
        background: var(--bg-card);
        border-radius: var(--radius-lg);
        border: 1px solid var(--border);
        overflow: hidden;
        display: flex;
        flex-direction: column;
      }

      .card-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 20px 24px;
        border-bottom: 1px solid var(--border);
        background: var(--bg-elevated);
      }

      .card-title {
        display: flex;
        align-items: center;
        gap: 12px;
        font-size: 16px;
        font-weight: 600;
      }

      .card-title-icon {
        width: 32px;
        height: 32px;
        background: var(--gradient-primary);
        border-radius: var(--radius-sm);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
      }

      .card-body {
        flex: 1;
        padding: 20px 24px;
        overflow-y: auto;
      }

      /* Command Panel */
      .command-panel .card-body {
        padding: 0;
        display: flex;
        flex-direction: column;
      }

      .command-input-section {
        padding: 24px;
        border-bottom: 1px solid var(--border);
      }

      .command-form {
        display: flex;
        gap: 12px;
        margin-bottom: 16px;
      }

      .command-input-wrapper {
        flex: 1;
        position: relative;
      }

      .command-input {
        width: 100%;
        padding: 16px 20px;
        padding-right: 50px;
        background: var(--bg-dark);
        border: 2px solid var(--border);
        border-radius: var(--radius-md);
        color: var(--text-primary);
        font-size: 15px;
        font-family: inherit;
        transition: all 0.2s;
      }

      .command-input:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.15);
      }

      .command-input::placeholder {
        color: var(--text-muted);
      }

      .voice-btn {
        position: absolute;
        right: 8px;
        top: 50%;
        transform: translateY(-50%);
        width: 36px;
        height: 36px;
        background: transparent;
        border: none;
        border-radius: var(--radius-sm);
        color: var(--text-muted);
        cursor: pointer;
        font-size: 18px;
        transition: all 0.2s;
      }

      .voice-btn:hover {
        color: var(--primary);
        background: rgba(99, 102, 241, 0.1);
      }

      .voice-btn.active {
        color: var(--danger);
        background: rgba(239, 68, 68, 0.1);
        animation: pulse-voice 1s infinite;
      }

      @keyframes pulse-voice {
        0%,
        100% {
          box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4);
        }
        50% {
          box-shadow: 0 0 0 10px rgba(239, 68, 68, 0);
        }
      }

      .send-btn {
        padding: 16px 28px;
      }

      /* Quick Actions */
      .quick-actions {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
      }

      .quick-btn {
        padding: 10px 16px;
        background: var(--bg-elevated);
        border: 1px solid var(--border);
        border-radius: 50px;
        color: var(--text-secondary);
        font-size: 13px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
        font-family: inherit;
      }

      .quick-btn:hover {
        background: var(--primary);
        border-color: var(--primary);
        color: white;
        transform: translateY(-1px);
      }

      /* Activity Feed */
      .activity-section {
        flex: 1;
        overflow: hidden;
        display: flex;
        flex-direction: column;
      }

      .activity-header {
        padding: 16px 24px;
        border-bottom: 1px solid var(--border);
        font-size: 12px;
        font-weight: 600;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .activity-list {
        flex: 1;
        overflow-y: auto;
        padding: 12px;
      }

      .activity-item {
        display: flex;
        gap: 12px;
        padding: 14px;
        border-radius: var(--radius-md);
        transition: background 0.2s;
      }

      .activity-item:hover {
        background: var(--bg-elevated);
      }

      .activity-icon {
        width: 40px;
        height: 40px;
        border-radius: var(--radius-sm);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        flex-shrink: 0;
      }

      .activity-icon.command {
        background: rgba(99, 102, 241, 0.15);
      }
      .activity-icon.success {
        background: rgba(16, 185, 129, 0.15);
      }
      .activity-icon.error {
        background: rgba(239, 68, 68, 0.15);
      }
      .activity-icon.warning {
        background: rgba(245, 158, 11, 0.15);
      }

      .activity-content {
        flex: 1;
        min-width: 0;
      }

      .activity-text {
        font-size: 14px;
        font-weight: 500;
        color: var(--text-primary);
        margin-bottom: 4px;
        word-wrap: break-word;
      }

      .activity-time {
        font-size: 12px;
        color: var(--text-muted);
      }

      /* Browser Preview */
      .browser-card {
        min-height: 500px;
      }

      .browser-frame {
        background: #0a0a12;
        border-radius: var(--radius-md);
        overflow: hidden;
        height: 100%;
        display: flex;
        flex-direction: column;
      }

      .browser-toolbar {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px 16px;
        background: #16162a;
        border-bottom: 1px solid var(--border);
      }

      .browser-controls {
        display: flex;
        gap: 8px;
      }

      .browser-control {
        width: 14px;
        height: 14px;
        border-radius: 50%;
      }

      .browser-control.close {
        background: #ff5f57;
      }
      .browser-control.minimize {
        background: #febc2e;
      }
      .browser-control.maximize {
        background: #28c840;
      }

      .browser-url-bar {
        flex: 1;
        padding: 8px 16px;
        background: var(--bg-dark);
        border-radius: 8px;
        font-size: 13px;
        color: var(--text-muted);
        font-family: "JetBrains Mono", monospace;
      }

      .browser-viewport {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 400px;
        position: relative;
      }

      .browser-viewport img {
        width: 100%;
        height: 100%;
        object-fit: contain;
      }

      .browser-placeholder {
        text-align: center;
        color: var(--text-muted);
      }

      .browser-placeholder-icon {
        font-size: 64px;
        margin-bottom: 16px;
        opacity: 0.5;
      }

      .browser-placeholder-text {
        font-size: 16px;
        font-weight: 500;
      }

      .browser-placeholder-hint {
        font-size: 13px;
        margin-top: 8px;
        opacity: 0.7;
      }

      /* Right Panel */
      .right-panel {
        display: flex;
        flex-direction: column;
        gap: 24px;
      }

      /* Approval Card */
      .approval-card {
        background: linear-gradient(
          135deg,
          rgba(245, 158, 11, 0.1) 0%,
          rgba(251, 191, 36, 0.05) 100%
        );
        border: 1px solid rgba(245, 158, 11, 0.3);
        border-radius: var(--radius-lg);
        padding: 20px;
        animation: slide-in 0.3s ease;
      }

      @keyframes slide-in {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .approval-header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 16px;
      }

      .approval-icon {
        width: 44px;
        height: 44px;
        background: var(--gradient-warning);
        border-radius: var(--radius-md);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 22px;
      }

      .approval-title {
        font-size: 16px;
        font-weight: 600;
        color: var(--warning);
      }

      .approval-desc {
        font-size: 14px;
        color: var(--text-secondary);
        margin-bottom: 16px;
      }

      .approval-details {
        background: rgba(0, 0, 0, 0.2);
        border-radius: var(--radius-md);
        padding: 14px;
        margin-bottom: 16px;
        font-family: "JetBrains Mono", monospace;
        font-size: 13px;
      }

      .approval-detail-row {
        display: flex;
        justify-content: space-between;
        padding: 6px 0;
        border-bottom: 1px solid var(--border);
      }

      .approval-detail-row:last-child {
        border-bottom: none;
      }

      .approval-detail-label {
        color: var(--text-muted);
      }

      .approval-detail-value {
        color: var(--text-primary);
        font-weight: 500;
      }

      .approval-actions {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
      }

      /* Task Progress */
      .task-card {
        padding: 20px;
      }

      .task-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
      }

      .task-id {
        font-size: 13px;
        color: var(--text-muted);
        font-family: "JetBrains Mono", monospace;
      }

      .task-badge {
        padding: 6px 12px;
        border-radius: 50px;
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .task-badge.in_progress {
        background: rgba(99, 102, 241, 0.2);
        color: var(--primary-light);
      }

      .task-badge.completed {
        background: rgba(16, 185, 129, 0.2);
        color: var(--success-light);
      }

      .task-badge.failed {
        background: rgba(239, 68, 68, 0.2);
        color: var(--danger-light);
      }

      .task-progress-bar {
        height: 8px;
        background: var(--bg-dark);
        border-radius: 4px;
        overflow: hidden;
        margin-bottom: 20px;
      }

      .task-progress-fill {
        height: 100%;
        background: var(--gradient-primary);
        border-radius: 4px;
        transition: width 0.5s ease;
      }

      .task-steps {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .task-step {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 10px 14px;
        background: var(--bg-elevated);
        border-radius: var(--radius-sm);
        font-size: 14px;
      }

      .task-step-icon {
        width: 24px;
        height: 24px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        font-weight: 600;
      }

      .task-step.completed .task-step-icon {
        background: var(--success);
        color: white;
      }

      .task-step.in_progress .task-step-icon {
        background: var(--primary);
        color: white;
        animation: pulse-dot 1s infinite;
      }

      .task-step.pending .task-step-icon {
        background: var(--bg-dark);
        color: var(--text-muted);
        border: 2px solid var(--border);
      }

      .task-step-text {
        flex: 1;
        color: var(--text-secondary);
      }

      .task-step.completed .task-step-text {
        color: var(--text-primary);
      }

      /* Empty States */
      .empty-state {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 40px 20px;
        text-align: center;
      }

      .empty-icon {
        font-size: 48px;
        margin-bottom: 16px;
        opacity: 0.5;
      }

      .empty-title {
        font-size: 16px;
        font-weight: 600;
        color: var(--text-secondary);
        margin-bottom: 8px;
      }

      .empty-hint {
        font-size: 14px;
        color: var(--text-muted);
      }

      /* Scrollbar */
      ::-webkit-scrollbar {
        width: 8px;
      }

      ::-webkit-scrollbar-track {
        background: transparent;
      }

      ::-webkit-scrollbar-thumb {
        background: var(--border);
        border-radius: 4px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: var(--border-light);
      }

      /* Responsive */
      @media (max-width: 1400px) {
        .main {
          grid-template-columns: 380px 1fr;
        }
        .right-panel {
          display: none;
        }
      }

      @media (max-width: 1000px) {
        .main {
          grid-template-columns: 1fr;
        }
        .header {
          padding: 12px 16px;
        }
        .main {
          padding: 16px;
        }
      }

      /* Loading Animation */
      .loading-dots {
        display: inline-flex;
        gap: 4px;
      }

      .loading-dots span {
        width: 8px;
        height: 8px;
        background: var(--primary);
        border-radius: 50%;
        animation: bounce 1.4s infinite ease-in-out both;
      }

      .loading-dots span:nth-child(1) {
        animation-delay: -0.32s;
      }
      .loading-dots span:nth-child(2) {
        animation-delay: -0.16s;
      }

      @keyframes bounce {
        0%,
        80%,
        100% {
          transform: scale(0);
        }
        40% {
          transform: scale(1);
        }
      }
    </style>
  </head>
  <body>
    <div class="bg-animation"></div>

    <div class="app">
      <!-- Header -->
      <header class="header">
        <div class="logo">
          <div class="logo-icon">ü§ñ</div>
          <div class="logo-text">
            <span class="logo-title">FinAgent</span>
            <span class="logo-subtitle">AI-Powered Finance Automation</span>
          </div>
        </div>

        <div class="header-actions">
          <div class="status-indicator" id="status-indicator">
            <div class="status-dot"></div>
            <span class="status-text" id="status-text">Disconnected</span>
          </div>

          <button class="btn btn-success" id="start-btn">
            <span>‚ñ∂</span> Start Agent
          </button>
          <button class="btn btn-danger" id="stop-btn" style="display: none">
            <span>‚ñ†</span> Stop
          </button>
        </div>
      </header>

      <!-- Main Content -->
      <main class="main">
        <!-- Command Panel -->
        <div class="card command-panel">
          <div class="card-header">
            <div class="card-title">
              <div class="card-title-icon">üí¨</div>
              <span>Command Center</span>
            </div>
          </div>

          <div class="card-body">
            <div class="command-input-section">
              <div class="command-form">
                <div class="command-input-wrapper">
                  <input
                    type="text"
                    class="command-input"
                    id="command-input"
                    placeholder="Type a financial command..."
                    autocomplete="off"
                  />
                  <button
                    class="voice-btn"
                    id="voice-btn"
                    title="Voice Input (Ctrl+M)"
                  >
                    üé§
                  </button>
                </div>
                <button class="btn btn-primary send-btn" id="send-btn">
                  Execute ‚Üí
                </button>
              </div>

              <div class="quick-actions">
                <button class="quick-btn" data-cmd="login to my account">
                  üîê Login
                </button>
                <button class="quick-btn" data-cmd="check my balance">
                  üí∞ Balance
                </button>
                <button
                  class="quick-btn"
                  data-cmd="pay electricity bill of 1250 rupees to Adani"
                >
                  ‚ö° Pay Bill
                </button>
                <button
                  class="quick-btn"
                  data-cmd="transfer 2000 rupees to Mom"
                >
                  üí∏ Transfer
                </button>
                <button
                  class="quick-btn"
                  data-cmd="buy digital gold worth 1000 rupees"
                >
                  ü•á Buy Gold
                </button>
              </div>
            </div>

            <div class="activity-section">
              <div class="activity-header">Activity Log</div>
              <div class="activity-list" id="activity-list">
                <div class="empty-state">
                  <div class="empty-icon">üìã</div>
                  <div class="empty-title">No Activity Yet</div>
                  <div class="empty-hint">Execute a command to get started</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Browser Preview -->
        <div class="card browser-card">
          <div class="card-header">
            <div class="card-title">
              <div class="card-title-icon">üåê</div>
              <span>Live Browser Preview</span>
            </div>
            <button class="btn btn-ghost" id="refresh-btn">‚Üª Refresh</button>
          </div>

          <div class="card-body" style="padding: 12px">
            <div class="browser-frame">
              <div class="browser-toolbar">
                <div class="browser-controls">
                  <div class="browser-control close"></div>
                  <div class="browser-control minimize"></div>
                  <div class="browser-control maximize"></div>
                </div>
                <div class="browser-url-bar" id="browser-url">
                  localhost:8080
                </div>
              </div>
              <div class="browser-viewport" id="browser-viewport">
                <div class="browser-placeholder">
                  <div class="browser-placeholder-icon">üñ•Ô∏è</div>
                  <div class="browser-placeholder-text">Browser Preview</div>
                  <div class="browser-placeholder-hint">
                    Start the agent to see live browser automation
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Right Panel -->
        <div class="right-panel">
          <!-- Approvals -->
          <div class="card">
            <div class="card-header">
              <div class="card-title">
                <div
                  class="card-title-icon"
                  style="background: var(--gradient-warning)"
                >
                  ‚ö†Ô∏è
                </div>
                <span>Pending Approvals</span>
              </div>
            </div>
            <div class="card-body" id="approvals-container">
              <div class="empty-state">
                <div class="empty-icon">‚úÖ</div>
                <div class="empty-title">All Clear</div>
                <div class="empty-hint">No actions awaiting approval</div>
              </div>
            </div>
          </div>

          <!-- Current Task -->
          <div class="card" style="flex: 1">
            <div class="card-header">
              <div class="card-title">
                <div
                  class="card-title-icon"
                  style="background: var(--gradient-success)"
                >
                  üìã
                </div>
                <span>Current Task</span>
              </div>
            </div>
            <div class="card-body" id="task-container">
              <div class="empty-state">
                <div class="empty-icon">üéØ</div>
                <div class="empty-title">No Active Task</div>
                <div class="empty-hint">
                  Tasks will appear here when running
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <script>
      // ===== State =====
      let ws = null;
      let isConnected = false;
      let isAgentRunning = false;
      let activities = [];
      let currentTask = null;
      let pendingApprovals = [];
      let recognition = null;
      let isListening = false;

      // ===== DOM Elements =====
      const commandInput = document.getElementById("command-input");
      const sendBtn = document.getElementById("send-btn");
      const voiceBtn = document.getElementById("voice-btn");
      const startBtn = document.getElementById("start-btn");
      const stopBtn = document.getElementById("stop-btn");
      const statusIndicator = document.getElementById("status-indicator");
      const statusText = document.getElementById("status-text");
      const activityList = document.getElementById("activity-list");
      const browserViewport = document.getElementById("browser-viewport");
      const browserUrl = document.getElementById("browser-url");
      const approvalsContainer = document.getElementById("approvals-container");
      const taskContainer = document.getElementById("task-container");
      const refreshBtn = document.getElementById("refresh-btn");

      // ===== Voice Recognition =====
      function initVoiceRecognition() {
        if (
          "webkitSpeechRecognition" in window ||
          "SpeechRecognition" in window
        ) {
          const SpeechRecognition =
            window.SpeechRecognition || window.webkitSpeechRecognition;
          recognition = new SpeechRecognition();
          recognition.continuous = false;
          recognition.interimResults = true;
          recognition.lang = "en-IN";

          recognition.onstart = () => {
            isListening = true;
            voiceBtn.classList.add("active");
            voiceBtn.innerHTML = "üî¥";
            commandInput.placeholder = "üé§ Listening... speak now";
            addActivity("üé§", "Listening for voice command...", "command");
          };

          recognition.onresult = (event) => {
            const transcript = Array.from(event.results)
              .map((result) => result[0].transcript)
              .join("");

            commandInput.value = transcript;

            if (event.results[0].isFinal) {
              stopVoice();
              if (transcript.trim()) {
                executeCommand(transcript);
              }
            }
          };

          recognition.onend = () => stopVoice();

          recognition.onerror = (event) => {
            addActivity("‚ùå", `Voice error: ${event.error}`, "error");
            stopVoice();
          };
        } else {
          voiceBtn.style.display = "none";
        }
      }

      function toggleVoice() {
        isListening ? stopVoice() : startVoice();
      }

      function startVoice() {
        if (recognition) {
          try {
            recognition.start();
          } catch (e) {
            console.error(e);
          }
        }
      }

      function stopVoice() {
        if (recognition && isListening) recognition.stop();
        isListening = false;
        voiceBtn.classList.remove("active");
        voiceBtn.innerHTML = "üé§";
        commandInput.placeholder = "Type a financial command...";
      }

      // ===== Agent Control =====
      async function startAgent() {
        try {
          addActivity("üöÄ", "Starting FinAgent...", "command");
          const response = await fetch("/api/start", { method: "POST" });
          const data = await response.json();

          if (data.status === "started" || data.status === "already_running") {
            isAgentRunning = true;
            startBtn.style.display = "none";
            stopBtn.style.display = "inline-flex";
            addActivity("‚úÖ", "Agent started successfully!", "success");
          }
        } catch (error) {
          addActivity("‚ùå", `Failed to start: ${error.message}`, "error");
        }
      }

      async function stopAgent() {
        try {
          await fetch("/api/stop", { method: "POST" });
          isAgentRunning = false;
          startBtn.style.display = "inline-flex";
          stopBtn.style.display = "none";
          addActivity("üõë", "Agent stopped", "command");
        } catch (error) {
          addActivity("‚ùå", `Failed to stop: ${error.message}`, "error");
        }
      }

      // ===== WebSocket =====
      function connect() {
        const protocol = window.location.protocol === "https:" ? "wss:" : "ws:";
        ws = new WebSocket(`${protocol}//${window.location.host}/ws`);

        ws.onopen = () => {
          isConnected = true;
          updateStatus(true);
          addActivity("üü¢", "Connected to FinAgent server", "success");
        };

        ws.onclose = () => {
          isConnected = false;
          updateStatus(false);
          setTimeout(connect, 3000);
        };

        ws.onmessage = (event) => {
          handleMessage(JSON.parse(event.data));
        };
      }

      function handleMessage(message) {
        switch (message.type) {
          case "initial_status":
            if (message.data.is_running) {
              isAgentRunning = true;
              startBtn.style.display = "none";
              stopBtn.style.display = "inline-flex";
            }
            if (message.data.pending_approvals?.length > 0) {
              pendingApprovals = message.data.pending_approvals;
              renderApprovals();
            }
            break;

          case "status":
            addActivity("‚ÑπÔ∏è", message.message, "command");
            break;

          case "screenshot":
            updateScreenshot(message.data);
            break;

          case "approval_request":
            pendingApprovals.push(message.data);
            renderApprovals();
            addActivity(
              "‚ö†Ô∏è",
              `Approval needed: ${message.data.description}`,
              "warning"
            );
            break;

          case "task_update":
            currentTask = message.data;
            renderTask();
            break;
        }
      }

      // ===== UI Updates =====
      function updateStatus(connected) {
        statusIndicator.className = `status-indicator ${
          connected ? "connected" : ""
        }`;
        statusText.textContent = connected ? "Connected" : "Disconnected";
      }

      function addActivity(icon, text, type) {
        activities.unshift({
          icon,
          text,
          type,
          time: new Date().toLocaleTimeString(),
        });
        activities = activities.slice(0, 30);
        renderActivities();
      }

      function renderActivities() {
        if (activities.length === 0) {
          activityList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üìã</div>
                        <div class="empty-title">No Activity Yet</div>
                        <div class="empty-hint">Execute a command to get started</div>
                    </div>
                `;
          return;
        }

        activityList.innerHTML = activities
          .map(
            (a) => `
                <div class="activity-item">
                    <div class="activity-icon ${a.type}">${a.icon}</div>
                    <div class="activity-content">
                        <div class="activity-text">${a.text}</div>
                        <div class="activity-time">${a.time}</div>
                    </div>
                </div>
            `
          )
          .join("");
      }

      function updateScreenshot(base64) {
        browserViewport.innerHTML = `<img src="data:image/png;base64,${base64}" alt="Browser Screenshot">`;
      }

      function renderApprovals() {
        if (pendingApprovals.length === 0) {
          approvalsContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">‚úÖ</div>
                        <div class="empty-title">All Clear</div>
                        <div class="empty-hint">No actions awaiting approval</div>
                    </div>
                `;
          return;
        }

        approvalsContainer.innerHTML = pendingApprovals
          .map(
            (a) => `
                <div class="approval-card">
                    <div class="approval-header">
                        <div class="approval-icon">‚ö†Ô∏è</div>
                        <div class="approval-title">${(a.action || "Action")
                          .replace(/_/g, " ")
                          .toUpperCase()}</div>
                    </div>
                    <div class="approval-desc">${a.description}</div>
                    <div class="approval-details">
                        ${Object.entries(a.parameters || {})
                          .filter(([k, v]) => v && k !== "parent_action")
                          .map(
                            ([k, v]) => `
                                <div class="approval-detail-row">
                                    <span class="approval-detail-label">${k}</span>
                                    <span class="approval-detail-value">${v}</span>
                                </div>
                            `
                          )
                          .join("")}
                    </div>
                    <div class="approval-actions">
                        <button class="btn btn-danger" onclick="handleApproval('${
                          a.id
                        }', false)">‚úï Reject</button>
                        <button class="btn btn-success" onclick="handleApproval('${
                          a.id
                        }', true)">‚úì Approve</button>
                    </div>
                </div>
            `
          )
          .join("");
      }

      function renderTask() {
        if (!currentTask) {
          taskContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üéØ</div>
                        <div class="empty-title">No Active Task</div>
                        <div class="empty-hint">Tasks will appear here when running</div>
                    </div>
                `;
          return;
        }

        const progress =
          (currentTask.current_step / currentTask.total_steps) * 100;

        taskContainer.innerHTML = `
                <div class="task-card">
                    <div class="task-header">
                        <span class="task-id">${currentTask.id}</span>
                        <span class="task-badge ${
                          currentTask.status
                        }">${currentTask.status.replace("_", " ")}</span>
                    </div>
                    <div class="task-progress-bar">
                        <div class="task-progress-fill" style="width: ${progress}%"></div>
                    </div>
                    <div class="task-steps">
                        ${currentTask.steps
                          .map(
                            (s) => `
                            <div class="task-step ${s.status}">
                                <div class="task-step-icon">
                                    ${
                                      s.status === "completed"
                                        ? "‚úì"
                                        : s.status === "in_progress"
                                        ? "‚óè"
                                        : currentTask.steps.indexOf(s) + 1
                                    }
                                </div>
                                <span class="task-step-text">${(
                                  s.action || "Step"
                                ).replace(/_/g, " ")}</span>
                            </div>
                        `
                          )
                          .join("")}
                    </div>
                </div>
            `;
      }

      // ===== Actions =====
      async function executeCommand(command) {
        if (!command.trim()) return;

        addActivity("üìù", `Command: ${command}`, "command");
        commandInput.value = "";

        if (ws && ws.readyState === WebSocket.OPEN) {
          ws.send(JSON.stringify({ type: "execute", command }));
        } else {
          try {
            const response = await fetch("/api/execute", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ command }),
            });
            const result = await response.json();
            currentTask = result.result;
            renderTask();
          } catch (error) {
            addActivity("‚ùå", `Error: ${error.message}`, "error");
          }
        }
      }

      async function handleApproval(requestId, approved) {
        pendingApprovals = pendingApprovals.filter((a) => a.id !== requestId);
        renderApprovals();

        addActivity(
          approved ? "‚úÖ" : "‚ùå",
          `Action ${approved ? "approved" : "rejected"}`,
          approved ? "success" : "error"
        );

        if (ws && ws.readyState === WebSocket.OPEN) {
          ws.send(
            JSON.stringify({ type: "approve", request_id: requestId, approved })
          );
        } else {
          await fetch("/api/approve", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ request_id: requestId, approved }),
          });
        }
      }

      async function refreshScreenshot() {
        try {
          const response = await fetch("/api/screenshot");
          const data = await response.json();
          if (data.screenshot) {
            updateScreenshot(data.screenshot);
          }
        } catch (error) {
          console.error("Screenshot error:", error);
        }
      }

      // ===== Event Listeners =====
      sendBtn.addEventListener("click", () =>
        executeCommand(commandInput.value)
      );
      commandInput.addEventListener("keypress", (e) => {
        if (e.key === "Enter") executeCommand(commandInput.value);
      });
      voiceBtn.addEventListener("click", toggleVoice);
      startBtn.addEventListener("click", startAgent);
      stopBtn.addEventListener("click", stopAgent);
      refreshBtn.addEventListener("click", refreshScreenshot);

      document.addEventListener("keydown", (e) => {
        if (e.ctrlKey && e.key === "m") {
          e.preventDefault();
          toggleVoice();
        }
        if (e.key === "Escape" && isListening) stopVoice();
      });

      document.querySelectorAll(".quick-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          const cmd = btn.dataset.cmd;
          commandInput.value = cmd;
          executeCommand(cmd);
        });
      });

      // ===== Initialize =====
      initVoiceRecognition();
      connect();
    </script>
  </body>
</html>
